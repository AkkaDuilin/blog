---
title: 计算机网络 - 链路层
categories:
  - 计算机网络
  - 数据通信
  - null
tags:
  - 计网
  - null
copyright: true
date: 2022-09-28 09:17:07
permalink:
description:
image:
---

<img src="https://" alt="" style="width:100%" />  

**前言**


数据链路层的主要功能：**局域网内主机之间的数据帧传输。**


<!-- more -->



# 数据链路层概述

##  数据链路层主要使用两种信道

1.  **点对点信道**：这种信道使用**一对一的点对点**通信方式。主要使用**PPP协议**。
2.  **广播信道**：这种信道使用**一对多的广播**通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的**共享信道协议**来协调这些主机的数据发送。主要使用**MAC协议。**

##  主要功能
数据链路层实现**物理层和网络层之间的协议**，提供**相邻节点的可靠数据**

在两个网络实体之间提供数据链路连接的**创建、维持和释放管理**。构成数据链路**数据单元**（frame：**数据帧或帧**），并对帧定界、同步、收发顺序的控制。并且包括传输过程中的网络流量控制、差错检测和差错控制等方面。

## 概念
```ad-question
# 数据链路和链路的区别，“电路接通了”与”数据链路接通了”的区别何在?

“电路接通了”表示链路两端的结点交换机已经开机，物理连接已经能够传送比特流了，但是，数据传输并不可靠，在物理连接基础上，再建立数据链路连接，才是“数据链路接通了”，此后，由于数据链路连接具有检测、确认和重传功能，才使不太可靠的物理链路变成可靠的数据链路，进行可靠的数据传输当数据链路断开连接时，物理电路连接不一定跟着断开连接。
```
### 链路：
- 又称**物理链路**，是一条无源的点到点的**物理线路段**，中间没有任何其他的交换结点。一条链路只是一条通路的一个组成部分。
### 数据链路：
- 传送数据时，需要一些必要的通信协议来控制这些数据的传输。将实现这些协议的硬件和软件加到链路上，构成了数据链路。最常用方法：网络适配器
### 协议数据单元：
- 数据链路层的协议数据单元是**数据帧**，简称**帧**。

```ad-note
# 以太网数据帧中的MAC和LLC
## MAC（一种协议，对接物理层）
- MAC介质控制访问
- 作用：数据帧的封装/卸载，帧的寻址和识别，帧的接收语发送，链路的管理，帧的差错控制等。MAC子层的存在屏蔽了不同的物理链路层种类的差异性

## LLC（对接网络层）
- LLC逻辑控制访问
- 作用：LLC子层的主要功能为传输可靠性保障和控制，数据包的分段与重组。数据包的顺序传播。

## 注解：
该协议位于OSI七层协议中数据链路层，数据链路层分为上层LLC（逻辑链路控制），和下层的MAC（媒体访问控制），**MAC主要负责控制与链接物理层的物理介质**。在发送数据的时候，MAC协议可以事先判断是否发送数据，如果可以发送将给数据加上一些控制信息，最终将数据以及控制信息以规定的格式发送到物理层；在接收数据的时候，MAC协议首先判断输入的信息并是否发生传输错误，如果没有错误，则去掉控制信息发送至LLC（逻辑链路控制）层。

```
# 三个基本功能
## 封装成帧
### 帧的组成
#### 帧头
源MAC地址，目的MAC地址
#### 数据
#### 帧尾
检验
### MTU 
- 最大传送单元 数据部分长度上限 1500字节
### 帧定界  
- 采用**SOH、EOT帧定界符**，放在帧的前后，标志帧的边界。可能存在**歧义**的问题，因为数据中也可能出现SOH、EOT，所以需要**转义（字符填充）**。
![[Pasted image 20221008154217.png]]

## 透明传输
- 无论怎么样的比特组合的数据，都能按照原样没有差错的通过链路层
### 问题：
如果数据中的**某个字节的二进制代码恰好和 SOH 或 EOT 一样**，数据链路层就会**错误地“找到帧的边界”。**
### 解决方案：字符填充 
将在数据部分出现的控制字符前**插入转义字符“ESC”**，在接收方的数据链路层将插入的转义字符**删除**。（**如果原字节流中已经存在转义字符，则需要再加上一个转义字符。**）
![[Pasted image 20221008155043.png]]

## 差错检测
检测比特差错(物理层传输时，比特可能出现错误，比如比特丢失，比特冗余，比特失序)

### 循环冗余检验CRC：
1.   在发送端，先把比特数据**划分为组**。假定每组数据M长度为 k 个比特。
   
2.   根据**生成多项式**（如x5+x3+1x5+x3+1）获取**除数P**（101001）。
   
3.   **在数据M的尾部加上n个0作为被除数**（**n的位数比p小1**）。
   
4.   将被除数除以除数P（**模二运算**），得到余数R，**R即为帧检测序列FCS**，将其**添加到M的尾部**发送出去。
```ad-tip
# 模二运算
   1. 除数与被除数最高几位（与除数位数相同）做异或，商1。（除数首位必须为1） 
     
   2. 余数先去掉首位，若此时余数最高位为1，商1，并对以它为除数继续模2除。若最高位为0，则商0，重复步骤2。   
   
   3. 直到余数位数小于除数位数时，运算结束
   
   https://blog.csdn.net/weixin_39450145/article/details/83987836
```

5.   **检验方法**：在接收端将收到的数据**除以除数P**，**看余数是否等于0**，等于0则认为帧没有差错，进行接收；否则出错，进行丢弃。（**只能保证无差错接收，如果要保证无差错传输，还需要加上确认和重传机制**）

# 点对点协议PPP
## 组成
1.  一个将IP数据报封装到串行链路的方法（**封装成帧**）。
2.  一个用来建立、配置和测试数据链路连接的**链路控制协议LCP。**
3.  一套**网络控制协议NCP。**
## 帧格式
![[Pasted image 20221008160454.png]]
## 字段含义

### F（1字节）：
**标志字段**，代表**定界符**。
### A、C（1字节）**：
A为地址字段，C为控制字段，但暂时没有含义。**
### 协议字段（2字节）：
表示当前信息部分是**IP数据报还是LCP的控制数据还是NCP的控制数据**。
### FCS（2字节）：
帧检测序列**，用于差错检测中的循环冗余检测CRC方法。

## 字节填充
### 使用场景：PPP使用**异步传输**，即**一个字节一个字节**传输。
### 实现方式：**软件。**
###  做法：
当信息字段中出现和标志字段相同的比特组合时，则进行字节填充的办法使得数据部分能够完整的传送到接收端。**（添加转义字符）**
1. 当信息字段中出现**0x7E**字节转变为**2字节序列(0x7D,0x5E)  **
2. 当信息字段中出现**一个0x7D**字节转变为**2字节序列(0x7D,0x5D)**
3. 当信息字段中出现**ASCII码的控制字符(数值小于0x20)**，在次字符**前加一个0x7D字节，将该字符的编码改变**  eg:  0x03变为(0x7D和0x23)

## 零比特填充
### 使用场景：PPP使用**同步传输**，即**连续的比特流传输**。
### 实现方式：**硬件**。
### 做法：
当信息字段出现了**5个连续的1**(*会被认为标志子段F*)，那么就**插入一个0**，在接收时再将5个连续的1后的0删除。

## 工作状态
### 链路静止:
链路没有被使用，物理层无活动载体，链路处于静默状态
### 链路建立:
当其中一端要进行通信时，将进入建立连接段，建立链路层的LCP连接;此阶
段，双方进行协商。如果协商成功，系统将进入认证阶段或直接进入联网阶段。
### 鉴别:
双方发送一些包进行认证。如果认证通过则进入联网阶段，否则终止连接。
### 网络层协议:
协商网络层协议。PPP规定双方在进行网络层数据交换之前要达成一一致， 因
为PPP支持网络层运行多个协议，接收方需要知道用哪个协议来接收数据。
### 链路打开:
开始交换用户数据和控制包。链路一直保持连接直到其中一方希望终止为止。
### 链路终止:
通信双方交换一些分组以消除和终止连接。


![[Pasted image 20221008161925.png]]


# 使用广播信道数据链路层

## 互联网的数据链路层

星型网/ 环形网 / 总线网

### 以太网的两个标准  
1.  **DIX Ethernet V2** 是世界上**第一个**局域网产品（以太网）的规约。
2.  **IEEE 802.3** 是第一个 IEEE 的以太网标准。

## 网络适配器（网卡）的作用
*实现数据链路层和物理层这两层的协议的硬件和软件*

1.  适配器用来连接**计算机与局域网**；同时要能够实现**以太网协议**；
2.  适配器和局域网之间的通信是通过双绞线或者电缆以串行传输的方式进行的；而适配器与计算机之间的通信是并行方式进行的，所以适配器要能够进行两种数据传送方式之间的**串并行转化**；
3.  网络上的数据率与计算机总线上的**数据率**不同，因此适配器要安装内存储器以进行两种速率下的缓存功能
4.  适配器要能够实现**以太网协议**
5.  **计算机的硬件地址（MAC地址）就在适配器的ROM中；（计算机的软件地址IP地址，在计算机的存储器中）**

![[Pasted image 20221008162314.png]]

## CSMA/CD 协议

## 星型以太网

-   **双绞线以太网**的出现，是局域网发展史上的一个重要的里程碑，从此以太网的拓扑结构从传统的总线型变为更为方便的**星形网络。**
-   优势：
    1.  **价格便宜**
    2.  **使用方便**


### 集线器特点

1. 集线器使用电子器件模拟实际电缆线的工作，所以使用集线器的以太网在逻辑上还是一个总线网，各站逻辑上共享总线。而且是用的还是**CSMA/CD协议**，同一时刻至多允许一个站发送数据（防止碰撞）
2. 集线器的接口通过两对双绞线与计算机上的适配器相连；一个集线器像是一个多接口的转发器
3. 集线器工作在物理层，每个接口只简单地转发比特，不进行碰撞检测
4. 集线器采用专门的芯片，进行自适应串音回波抵消。
  


## 信道利用率

## 以太网mac层
- MAC地址  硬件地址/物理地址 

### MAC帧格式
-   前两个字段为**6字节的目的地址和6字节的源地址**。第三个字段为**2字节的类型字段**，表示上一层的协议。第四个字段是**数据字段，长度为46到1500字节**，一般是网络层交付的**IP数据报**。第五个字段是长度为**4个字节的帧检测序列FCS**。
-   MAC帧的长度范围是：**64字节到1518字节**首尾部分的控制信息占**18字节**
	其中，64字节的最小长度是CSMA/CD协议的规定（**确保通过争用期**）
-   当MAC帧向下交付给物理层时，需要加上**7个字节的前同步码（实现发送端和接收端之间的位同步）和1个字节的帧开始定界符（无结束定界符，直接观察曼彻斯特编码即可）**。
-   MAC帧中并没有**数据长度**的标识，但由于传输时使用的是曼彻斯特编码的方式，所以通过对曼彻斯特编码的信号特点的观察便可确定是否传送完毕；（曼彻斯特编码信号的码元正中间有一次电压转换）
  
![[Pasted image 20220929090350.png]]


## 以太网扩展


<hr />
版权信息