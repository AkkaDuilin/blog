---
title: 计算机网络 - 网络层
categories:
  - 计算机网络
  - 数据通信
  - null
tags:
  - 计网
  - null
copyright: true
date: 2022-10-13 09:17:07
permalink:
description:
image:
---

<img src="https://" alt="" style="width:100%" />  

**前言**




<!-- more -->

# 重要概念
## 网络层功能

1.  网络层**面向无连接，不负责提供可靠的服务**。将确保数据可靠的任务交给了上层的**运输层（TCP协议**）。
2.  数据链路层是局域网内，而网络层将范围扩大至互联网，即世界上最大的互连网。**负责为互联网上任意两台主机提供分组交换服务。**

## 设计思路
### 虚电路服务
模仿电信网络，使用面向连接的通信方式
### 数据报服务
网络层向上只提供**简单灵活的、无连接的、尽最大努力交付的**数据报服务。不提供**服务质量的承诺**，使路由器比较简单。
![[Pasted image 20221024102902.png]]

## 两个层面
### 控制层面


### 数据层面
![[Pasted image 20221024103050.png]]

# 网际协议 IP
## 主要协议
-   **网际协议IP（Internet Protocol）**：Robert Kahn和Vint Cerf共同研发。
-   **地址解析协议ARP（Address Resolvotion Protocol）**。
-   **网际控制报文协议ICMP（Internet Control Message Protocol）**。
-   **网际组管理协议IGMP（Internet Group Management Protocol）**。

## 虚拟互联网络
-   即**逻辑互联网络**,**忽略物理层的客观异构性,在网络层看起来好像是一个统一的网络**,即互联网可以有多种异构的网络组成。（就像操作系统的逻辑设备一样，屏蔽差异）如果在这种覆盖全球的 IP 网的上层使用 TCP 协议，那么就是现在的**互联网 Internet**
-   网络互联的一些中间设备：
    1.  **物理层：转发器、集线器**
    2.  **数据链路层：网桥（扩展局域网）**
    3.  **网络层：路由器（连接局域网）**
    4.  **网络层以上：网关、桥路器**
  
## IP 地址
- 32位二进制代码
- 互联网上每台主机/路由器的**每个接口**分配一个在**全世界唯一**的IP地址
![[Pasted image 20221024103647.png]]

### 二级结构
两个字段 网络号、主机号
**IP 地址 :: = {<网络号>,<主机号>}**

### 分类
-   **A类地址**：**8位网络号**，第一位是标识位**0**；24位主机号。
-   **B类地址**：**16位网络号**，前两位是标识位**10**；16位主机号。
-   **C类地址**：**24位网络号**，前三位是标识位**110**；8位主机号。
-   **D类地址**：前四位是标识位**1110**，用于**一对多通信**。
-   **E类地址**：前四位是标识位**1111**，留作**以后使用。**
![[Pasted image 20221024104034.png]]  

```ad-note
# 一般不使用的特殊IP地址

![[Pasted image 20221024104411.png]]

# 指派范围

-   A类地址网络号占用**一个字节**，但是由于有一位是类别位，**只有7位可供使用**，但是由于规定，**网络字段全0是个保留字段表示本网络，而127（01111111）是另外一个保留字段，作为本地软件的环回测试。**我们常见的127.0.0.1表示本机，原因也是出自这里。所以A类地址可以指派的网络号个数为**（2^7-2）**.
-   B类网络地址网络号有**两个字节**，前两位为10已经固定，**只剩下14位可用**，由于这14位无论怎么取值都不会使得网络号为全0或者全1，但实际上规定，**规定B类最小网络地址为128.1.0.0**。因此B类地址可指派的网络号个数为**（2^14-1）.**
-   C类地址有**3个字节**的网络字段号，前三位固定110，**只有剩下21位可用**，同样C类地址可指派的最小网络地址也是**192.0.1.0**。因此C类地址可指派的网络号个数为**（2^21-1）.**
-   A、B、C三类地址的主机号，**全0或全1均有特殊作用**，分别表示本主机和当前网络内全部主机，所以可用的主机号为**（2^（n-1））**。
  


```

### CIDR
无分类域间路由选择
#### 网络前缀
**两个字段： IP 地址 ::= {<网络前缀>,<主机号>}**

前缀位数不固定，用斜线记法记录在IP地址后

eg： 128.14.35.7/20 前20位是网络前缀

#### 地址块
将网络前缀相同的所有连续CIDR地址块

![[Pasted image 20221024110239.png]]
```ad-tip
- 128.14.35.7/20 是**IP地址**，是128.14.35.0/20 地址块的一个地址

- 128.14.35.0/20 是**包含多个IP地址的地址块**

```
#### 地址掩码
- 又称**子网掩码**
- 32位 由一串1和连着的一串0组成，**1的个数是网络前缀的长度**
![[Pasted image 20221024112211.png]]

网络地址 = IP and 地址掩码
![[Pasted image 20221024112300.png]]


### IP地址特点
-   P地址是一种**分等级**的地址结构。好处是：
    1.  IP 地址管理机构在分配 IP 地址时**只分配网络号**，而剩下的主机号则由得到该网络号的单位自行分配。这样就**方便了 IP 地址的管理**。
    2.  路由器仅**根据目的主机所连接的网络号**来转发分组（而不考虑目的主机号），这样就可以**使路由表中的项目数大幅度减少，从而减小了路由表所占的存储空间**。 （转发到目的网络后，由目的网络的路由器转发至具体的主机）

-   实际上 IP 地址是**标志一个主机（或路由器）和一条链路的接口。**
    1.  **多归属主机**：当一个主机同时连接到两个网络上时，该主机就必须**同时具有两个相应的 IP 地址**，其网络号 net-id 必须是不同的。
    2.  **路由器**：由于一个路由器**至少应当连接到两个网络**（这样它才能将 IP 数据报从一个网络转发到另一个网络），因此一个路由器**至少应当有两个不同的 IP 地址**。

-   用**转发器（物理层）或网桥（数据链路层）**连接起来的若干个局域网仍为一个网络，因此这些局域网都具有同样的网络号 net-id。（**网络层的路由器才是连接不同网络的中继系统**）前者仅仅是**扩展局域网**，后者是**连通局域网**。

-   所有分配到网络号 net-id 的网络，无论是范围很小的局域网，还是可能覆盖很大地理范围的广域网，都是**平等的。**
  
```ad-tip
- 同一个局域网的主机或路由器的IP地址中的网络号必须一样
- 路由器的每一个接口都有一个不同网络号的IP地址
```

### IP地址与硬件地址的区别：

1.  **硬件地址（或物理地址、MAC地址）**是**数据链路层和物理层**使用的地址。而**IP 地址**是**网络层和以上各层**使用的地址，是一种**逻辑地址**（称 IP 地址是逻辑地址是因为 IP 地址是用软件实现的）
2.  **IP 地址放在 IP 数据报的首部，而硬件地址则放在 MAC 帧的首部**。当已知主机或路由器的IP地址后，需要通过**ARP地址**解析协议得出其MAC地址。
3.  网络层只能看见IP地址，数据链路层只能看见硬件地址。
4.  分组每次经过路由器转发时都要将MAC帧的首部和尾部丢弃重新封装——**变换MAC帧中的目的MAC地址和源MAC地址。而IP数据报中的源IP地址和目的IP地址始终不变。**

### 地址解析协议ARP 
#### 作用：
**从IP地址解析出MAC地址**

#### ARP高速缓存
存放IP地址到MAC地址的映射表
**< IP address；MAC address；TTL >**
TTL - 生存时间

#### 流程
![[Pasted image 20221024184932.png]]


### IP数据报(分组)

![[Pasted image 20221024114938.png]]
#unfinish
# IP层转发分组的过程
## 基于终点的转发
- 分组是**逐跳转发**的
- 基于分组首部中的**目的地址**传送和转发
### 过程
#### 检查目的地址是否在网络
- 目的地址与网络掩码逐比特AND
- 结果是否等于网络地址
#### 若是，直接交付
#### 若不是，交送给路由器
- 路由器受到分组后查找转发表
- 前缀匹配 
### 最长前缀匹配
- 选择前缀最长的一个匹配

```ad-note
# 主机路由
- 网络前缀  **a.b.c.d/32**
- 对特点主机的IP地址专门指明一个路由
- 放在转发表**最前面**
# 默认路由
- 特殊前缀 **0.0.0.0/0**
- 不管最终目的网络在那，都由指定路由器R处理
```

# 网际控制报文协议ICMP
- ICMP (Internet ControlMessage Protocol) 允许主机应用层或路由器**报告差错**情况和提供运输层有关**异常**情况的报告
- 可以知道主机是否在线
## 格式
![[Pasted image 20221103094452.png]]


# more

<hr />
版权信息