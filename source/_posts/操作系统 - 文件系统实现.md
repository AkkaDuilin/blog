---
title: 操作系统 - 文件系统实现 
date: 2022-12-05 13:31:48   
permalink:         
categories:  
    - 操作系统
    -
    -        
tags: 
    - 操作系统
    - 存储管理
    - 文件系统          
description:        
image:             
copyright: true     
---

<img src="https://" alt="" style="width:100%" />  

**前言**


操作系统 - 文件系统实现


<!-- more -->

# 文件系统
- 在存储设备上组织文件的方法和数据结构
- 负责管理和存储文件信息的模块
## 层次结构
### 逻辑文件系统
- 管理文件数据外的所有结构数据
- FCB
- 文件目录组织管理
### 文件组织模块
- 管理文件、逻辑块、物理块
- 把文件的逻辑地址转为物理地址
- 管理空闲空间
- 为文件分配物理块
### 基本文件系统
- 负责物理块读写
- 向设备驱动程序发送控制命令
 
## 基本概念
### 物理块
- 一个或多个扇区
### 物理分区
- 磁盘分割成若干独立空间
### 卷
- 磁盘上的逻辑分区
- 每个卷可以建立一个文件系统

## 实现
### 磁盘文件系统
- 引导控制块  包含系统引导操作系统的各种信息
- 分区控制块  包含分区信息
- 目录和FCB
- 用户文件
### 内存文件系统
- 分区表/目录缓冲结构/系统打开文件表/进程打开文件表
- 目的：**通过缓冲技术提高文件系统性能**



### 虚拟文件系统  VFS
- 为支持多个文件系统，引入虚拟文件系统VFS
- 把多个文件系统整合成一个目录结构
### 网络文件系统  NFS
- 通过LAN/WAN 访问远程文件系统的软件系统的实现
# 连续分配

## 物理块
- 读写存储设备的基本单位
- 存储设备的基本分配单位
- 大小 ：**4KB的倍数**
## 逻辑块
- 文件空间中的块
- 一个逻辑块存储在一个物理块中

## 连续分配
- 每个文件在磁盘上占用一组连续的物理块
- **FCB 给出 起始块号/长度**
![[Pasted image 20221205194332.png]]
## 地址映射
- 逻辑地址  LA 文件内相对地址
- 物理地址  (B,D)  存在在物理块中的地址
- 物理块大小  S
- 块内偏移  D 
- **LA / S  商为Q逻辑块号 余数为D块内偏移**

## 性能分析
### 优点
- 支持随机访问
- 存取速度快
- 适用一次性写入
### 缺点
- 浪费空间
- 文件不能动态增长
- 不利于文件插入和删除

# 链接分配
- 文件信息存放在若干不连续物理块中
- 文件的所有物理块通过指针链成链表结构

## 隐式链接
- 链表的指针隐藏在物理块中
- **每个物理块中的指针指向下一个物理块**
- **FCB给出文件首块地址结束地址**
- 文件结束与空指针
- 4KB物理块，指针4Byte  共4092Byte 

## 地址映射
- 逻辑地址  LA 文件内相对地址
- 物理地址  (B,D)  存在在物理块中的地址
- 物理块大小  S
- 指针大小  P
- 访问块号B = 链表中第Q项对应的物理块块号
- 块内偏移  D 
-  **LA / (S - P)  商为Q逻辑块号 余数为D块内偏移**

## 性能分析
### 优点
- 可以离散存放，提高磁盘利用率
- 动态扩充文件大小
- 便于文件插入和删除
### 缺点
- 访问文件慢 访问第i块，需要把之前所有块读入
- 不可靠

## 显式链接
- 指针集中存放
- 把所有指针存放在一张链接表中
- 提高检索速度
- **FCB指向起始块号**
###  FAT文件分配表
- 单个文件不能大于4G
- **管理最大磁盘空间 每个物理块 * 最大表项数**

# 索引分配
- 索引块 ：存放指向文件每个物理块块号的物理块
- 索引块中的第i个项j存放第i个逻辑块对应的物理块块号j
- **FCB指向索引块**

## 地址映射
 逻辑地址  LA 文件内相对地址
- 物理地址  (B,D)  存在在物理块中的地址
- 物理块大小  S
- 访问块号B = 链表中第Q项对应的物理块块号
- 块内偏移  D 
-  **LA / S  商为Q逻辑块号 余数为D块内偏移**

## 性能分析
### 优点
- 支持随机访问
- 离散存放，没有碎片
### 缺点
- 需要额外空间存放索引表
- 磁盘访问时间增加

# 空闲空间分配
## 空闲表
- 空闲区：连续的未分配物理块集合
- 每个表项对应一个空闲区
## 空闲链表
- 将磁盘上的所有空闲块链接在一个链表中

## 位示图
- 利用二进制来表示一个块的使用情况
- 1空闲  0已分配
### 块号计算
![[Pasted image 20221205213415.png]]

| 分配方式     | FCB           |
| ------------ | ------------- |
| 连续分配     | 起始块号 长度 |
| 隐式链接分配 | 起始块号 结束块号     |
| 显式链接分配 | 起始块号          |
| 索引分配             | 索引块号          |


# more

<hr />
版权信息