---
title: 汇编代码
categories:
  - null
  - null
  - null
tags:
  - 汇编
  - null
copyright: true
date: 2022-08-01 16:22:24
permalink:
description:
image:
---

<img src="https://" alt="" style="width:100%" />  

**前言**


汇编代码和原始的C代码相差比较大，一些通常对C语言程序员隐蔽的处理器状态是可见的：

程序计数器(PC，用 %eip 表示)指示将要执行的下一条指令在存储器中的地址。
程序计数器(PC，用 %eip 表示)指示将要执行的下一条指令在寄存器中的地址。
整数寄存器文件包含 8 个命名的位置，分别存储 32 位的值。这些寄存器可以存储地址(对应于 C 语言的指针)或证书数据。有的寄存器被用来记录某些重要的程序状态，而其他的寄存器则用来保存临时数据。
条件码(codition code)寄存器保存着最近执行的算术或逻辑指令的状态信息。它们用来实现控制或数据流中的条件变化。
一组浮点寄存器存放浮点数据。


<!-- more -->

# CPU基本功能

1. 执行机器指令
2. 暂存少量数据
3. 访问寄存器

# 数据格式

<a href="https://sm.ms/image/JV4Sr8Dpyq9HzZx" target="_blank"><img src="https://s2.loli.net/2022/08/02/JV4Sr8Dpyq9HzZx.png" ></a>




# 操作数指示符
大多数指令有一个或多个操作数(operand)，指示出执行一个操作中要引用的源数据值，以及放置结果的目标位置。操作数可能被分为三种类型：

1. 立即数(immediate)，也就是常数值
2. 寄存器(register)，表示某个寄存器的内容
3. 寄存器(memory)引用，它会根据计算出来的地址访问某个寄存器位置


<a href="https://sm.ms/image/bJ84KYTCsHigZP7" target="_blank"><img src="https://s2.loli.net/2022/08/02/bJ84KYTCsHigZP7.png" ></a>


# 保护方式和实地址方式

## 保护方式
全部32根地址，寻址4G
支持**虚拟8086方式**

## 实地址方式
对应保护方式下的虚地质。

# 寄存器

## 通用寄存器

IA-32系列有**8个32位寄存器** EAX,EBX,ECX,EDX,ESP,EBP,ESI,EDI

8个寄存器的底16位相当于**8个16位寄存器** AX，BX，CX，DX，SP，BP，SI，DI

AX,BX,CX,DX 高、低8位可以分解成**8个独立的8位寄存器**
AH BH CH DH 
AL BL CL DL

## 标志寄存器
1. 进位标志(CF)
- 若运算结果最高位产生进位或借位，置为1 
2. 零标志(ZF)
- 运算结果为0置为1
3. 符号标志(SF)
- 与运算结果最高位相同
4.  溢出标志(OF)
- 反映有符号数加减运算是否溢出
- 溢出记为1
5. 奇偶标志(PF)
- 最低字节含有1的位数是偶数还是奇数
- 偶数PF为1
6. 辅助进位标志(AF)
- 最后四位向前有借位或者进位


## 段寄存器
- CPU能够通过地址线直接访问的存储器称为内存
- 程序在存储器中映像有三部分 代码、数据、堆栈
- 物理地址 = 段起始地址 + 偏移
- 逻辑地址二维 物理地址一维
- 段号得到起始地址，加偏移得到物理地址

### 四个段寄存器
1. CS 代码段寄存器
2. SS 堆栈段寄存器
3. DS 数据段寄存器
4. ES 附加段寄存器

- 四个段可以部分重叠可以不连续


# 指令

## 简单指令

1. 数据传送指令 MOV

<a href="https://sm.ms/image/jLvqNehi8JEPsUr" target="_blank"><img src="https://s2.loli.net/2022/08/02/jLvqNehi8JEPsUr.png" ></a>

2. 交换指令 XCHG

XCHG OPRD1,OPRD2

把操作数OPRD1和OPRD2的内容交换
OPRD可以是通用寄存器或者存储单元  两个操作数尺寸必须一致


3. 加法指令 ADD

ADD DEST，SRC

DEST <- DEST + SRC
DEST可以是通用寄存器或者存储单元 SRC寄存器、存储单元或者立即数 操作数尺寸一致 进位溢出

4. 减法指令 SUB

SUB DEST，SRC

DEST <- DEST -SRC
DEST可以是通用寄存器或者存储单元 SRC寄存器、存储单元或者立即数 操作数尺寸一致

5. 减一指令 DEC

DEC DEST

DEC <- DEST - 1
DEST可以是通用寄存器或者存储单元

6. 加一指令 INC

INC DEST

INC <- DEST + 1
DEST可以是通用寄存器或者存储单元

7. 取补指令 NEG

NEG OPRD

OPRD <- 0-OPRD
操作数以补码表示
DEST可以是通用寄存器或者存储单元

## 状态标志指令

1. CLC 
进位清零  CF <- 1

2. STC 
置进位标志 CF <- 0

3. CMC 
进位标志取反

4. LAHF 
获取状态标志
- 将状态寄存器低8位送到AH中

5. SAHF
设置状态标志
使状态标志成为AH中对应值

## 带进位加减法
1. ADC
ADC DEST,SRC

DEST <- DEST + SRC + CF
- SRC 可以是立即数、通用寄存器、存储单元
- DEST 可以是通用寄存器或存储单元
- 两个操作数尺寸必须一致

2. SBB
SBB DEST,SRC

DEST <- DEST - (SRC+CF)
- SRC 可以是立即数、通用寄存器、存储单元
- DEST 可以是通用寄存器或存储单元
- 两个操作数尺寸必须一致



# 寻址方式

## 立即寻址
MOV EAX,12345678H
- 操作数本身包含在指令中，跟在操作码之后存放在代码段中
- 这样的操作数称为立即数
- 采用“高高低低”原则
- 只有源操作数可以使用立即寻址


## 寄存器寻址
MOV EBP,ESP
- 操作数保存在CPU内部寄存器 指令中指定寄存器

## 寄存器直接寻址
MOV ECX,[95480H]
指令包含操作数所在的存储单元的有效地址

## 寄存器间接寻址
MOV EAX,[ESI]
通过寄存器间接给出存储单元有效地址的方式

## 通用表示
- 三部分内容相加
	- 32位基地址寄存器的起始地址
	- 可乘比例因子的变址寄存器
	- 8位、16位、32位的位移量
三部分可省去任意两部分


# xx3x

<hr />
版权信息