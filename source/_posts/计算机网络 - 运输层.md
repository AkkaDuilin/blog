---
title: 计算机网络 - 运输层
date: 2022-12-04 14:53:53   
permalink:         
categories:
  - 计算机网络
  - 数据通信
  - null
tags:
  - 计网
  - null        
description:        
image:             
copyright: true     
---

<img src="https://" alt="" style="width:100%" />  

**前言**

计算机网络 - 运输层



<!-- more -->

# 运输层概述
## 作用
- 运输层**向上层的应用层**提供通信服务
- 提供**应用进程间**的逻辑通信
- 向高层用户**屏蔽**了下面网络核心的细节
![[Pasted image 20221204150121.png]]

## UDP和TCP
### 信道
- UDP使用无连接协议，不可靠信道
- TCP使用面向连接协议，全双工可靠信道
### 数据单元
- **UDP使用UDP报文或用户数据报**
- **TCP使用TCP报文段**
### 建立连接
- UDP不需要建立连接
- TCP提供面向连接的服务，必须建立连接

![[Pasted image 20221204150808.png]]

## 端口
### 分用和复用
-  复用：应用进程都可以通过运输层再传送到 IP 层（网络层）。
-  分用：运输层从 IP 层收到发送给应用进程的数据后，必须分别交
付给指明的各应用进程。

### 端口号
- 解决指明应用程序，只具有本地意义
- 两类  服务器端使用端口号  客户端使用端口号


# UDP
## 特点
1. **无连接**。发送数据之前不需要建立连接。
2. 使用尽最大努力交付。即**不保证可靠交付**。
3. **面向报文**。UDP 一次传送和交付一个完整的报文，发送方对应用层报文不做处理原样发送，接收方对IP层上交报文去除首部后交付，一次交付一个完整报文
4. **没有拥塞控制**。网络出现的拥塞不会使源主机的发送速率降低。很适合多媒体通信的要求。
5. 支持一对一、一对多、多对一、多对多等交互通信。
6. **首部开销小**，只有 8 个字节。
**UDP 通信的特点：简单方便，但不可靠。**

## 首部格式
1. 源端口：源端口号。在需要对方回信时选用。不需要时可用全 0。
2. 目的端口：目的端口号。终点交付报文时必须使用。
3. 长度：UDP 用户数据报的长度，其最小值是 8（仅有首部）。
4. 检验和：检测 UDP 用户数据报在传输中是否有错。有错就丢弃。

![[Pasted image 20221204153131.png]]
# TCP
## 特点
1. TCP 是面向连接的运输层协议。
2. 每一条 TCP 连接只能有两个端点 (endpoint)，每一条 TCP 连接只能是点
对点的（一对一）。
3. TCP 提供可靠交付的服务。
4. TCP 提供全双工通信。
### 面向字节流
1. TCP 中的“流”(stream) 指的是流入或流出进程的字节序列。
2. 面向字节流：虽然应用程序和 TCP 的交互是一次一个数据块，但 TCP
把应用程序交下来的数据看成仅仅是一连串无结构的字节流。
![[Pasted image 20221204154408.png]]

## 首部格式
![[Pasted image 20221204154648.png]]
- 源端口/目的端口
- 序号 序号字段的值则指的是本报文段所发送的数据的第一个字节的序号
- 确认号 期望收到对方的下一个报文段的数据的第一个字节的序号
- 数据偏移 指出 TCP 报文段的数据起始处距离TCP 报文段的起始处有多远
- 保留
- URG紧急  为1时紧急传送，优先级高
- ACK确认  为1时确认号有效
- PSH推送  为1时尽快交付接受
- RST复位  为1时表明 TCP 连接中出现严重差错，要重新建立连接
- SYN同步  
	同步 SYN = 1 表示这是一个连接请求或连接接受报文。
	当 SYN = 1，ACK = 0 时，表明这是一个连接请求报文段。
	当 SYN = 1，ACK = 1 时，表明这是一个连接接受报文段。
- FIN终止 为1时表明此报文段的发送端的数据已发送完毕，并要求释放运输连接
- 窗口   窗口字段明确指出现在允许对方发送的数据量 窗口会动态变化
- 检验和  检验和字段检验的范围包括首部和数据这两部分
- 紧急指针  在 URG = 1时，指出本报文段中的紧急数据的字节数
- 选项  最长40字节
- 填充  使整个 TCP 首部长度是 4 字节的整数倍

## 可靠传输
### 停止等待协议
- 每发送完一个分组就停止发送，等待对方的确认。在收到确认后再发送下一个分组
- 假设仅考虑 A 发送数据，而 B 接收数据并发送确认。因此 A 叫做发送方，而 B 叫做接收方
- 若出现差错，B不发送信息
- 解决方法 超时重传
- 确认丢失/确认迟到
```ad-note
# 超时重传
1. A 为每一个已发送的分组设置一个超时计时器。
2. A 只要在超时计时器到期之前收到了相应的确认，就撤销该超时
计时器，继续发送下一个分组 M2 。
3. 若 A 在超时计时器规定时间内没有收到 B 的确认，就认为分组错
误或丢失，就重发该分组。
# 确认丢失
1. 若 B 所发送的对 M1 的确认丢失了，那么 A 在设定的超时重传
时间内将不会收到确认，因此 A 在超时计时器到期后重传 M1。
2. 假定 B 正确收到了 A 重传的分组 M1。这时 B 应采取两个行动：
	1. 丢弃这个重复的分组 M1，不向上层交付。
	2. 向 A 发送确认。
# 确认迟到
1. B 对分组 M1 的确认迟到了，因此 A 在超时计时器到期后重传
M1。
2. B 会收到重复的 M1，丢弃重复的 M1，并重传确认分组。
3. A 会收到重复的确认。对重复的确认的处理：丢弃。

```

### 信道利用率

$$
\text { 信道利用率 } \quad U=\frac{T_{D}}{T_{D}+\mathrm{RTT}+T_{A}}
$$
- RTT 往返时间$
- $T_D$ 发送时间 $T_A$ 接受时间

### 连续ARQ协议
- 发送窗口：发送方维持一个发送窗口，位于发送窗口内的分组都可
被连续发送出去，而不需要等待对方的确认。
- 发送窗口滑动：发送方每收到一个确认，就把发送窗口向前滑动一
个分组的位置。
-  累积确认：接收方**对按序到达的最后一个分组发送确认**，表示：到
这个分组为止的所有分组都已正确收到了。

# xx3x

<hr />
版权信息